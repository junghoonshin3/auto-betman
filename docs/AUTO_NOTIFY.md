# 자동 알림 동작 정리

## 결론

네. `/login` 성공 후에는 자동 감시 대상에 등록되어, 봇이 켜져 있는 동안 주기적으로 신규 구매를 감지합니다.

## 정확한 동작 조건

- 감시 시작: `/login` 성공 시 자동 등록
- 감시 주기: `POLLING_INTERVAL_MINUTES` (기본 5분, 1~60)
- 신규 판단 기준: `slip_id`가 이전에 본 목록에 없을 때
- 알림 위치: `DISCORD_CHANNEL_ID` 채널
- 멘션: 없음
- 재로그인 동작: `/login` 성공 직후 1회 즉시 조회하여 이전 기준선 대비 신규 구매만 즉시 알림
- 알림 포맷: `/purchases`와 동일하게 게임유형 섹션(승부식/승무패/기록식/기타)으로 묶어 표시
- 내 픽 강조: 팀명 색상 대신 `🎯` + 굵게(`**팀명**`)로 표현 (무승부는 `무승부 픽` 표기)

## 재시작/중단 동작

- 봇 재시작 후: `storage/session_state_*.json`이 있으면 자동으로 감시 복원
- `/logout` 실행 시: 해당 사용자 감시 즉시 중단
- 세션 만료 시: 해당 사용자 감시 중단 + 채널에 재로그인 안내 (마지막 `slip_id` 기준선은 유지)
- 다시 감시하려면: `/login` 재실행

## 처음 로그인 직후 알림이 없는 이유

- 첫 감시 사이클은 기존 구매내역을 기준선(baseline)으로만 저장합니다.
- 따라서 “기존 건”은 알리지 않고, 그 이후 새로 생긴 `slip_id`만 알림이 갑니다.

## 실구매 없이 확인하기

- `FAKE_PURCHASES_FILE`을 설정하면 가짜 구매 JSON으로 테스트할 수 있습니다.
- 파일에 새로운 `slip_id`를 추가하면 다음 주기에 신규 알림이 발생합니다.

## 빠른 점검 체크리스트

1. `.env`에 `DISCORD_CHANNEL_ID`, `POLLING_INTERVAL_MINUTES` 설정
2. (테스트 모드면) `FAKE_PURCHASES_FILE` 설정
3. 컨테이너/프로세스 재시작
4. 디스코드에서 `/login` 성공
5. 신규 `slip_id` 생성 후 한 주기 대기
