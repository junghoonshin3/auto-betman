# Auto Betman 사용법

## 시작하기

봇이 실행되면 설정한 채널에 **"Betman Tracker 시작됨 ✔"** 메시지가 표시됩니다.
채팅창에 `/`를 입력하면 사용 가능한 명령어 목록이 자동완성으로 나타납니다.

---

## 계정 등록 (`/setup`)

베트맨 구매내역을 조회하려면 먼저 계정을 등록해야 합니다.

### `/setup register` — 계정 등록

1. 채팅창에 `/setup register` 입력 후 실행
2. 모달 팝업이 표시됨:
   - **베트맨 아이디** — betman.co.kr 사이트 아이디
   - **베트맨 비밀번호** — 사이트 비밀번호
   - **알림 방식** — `dm` (개인 메시지) 또는 `channel` (채널에 멘션)
3. 제출하면 **"등록 완료!"** 확인 메시지 표시

> 알림 방식 기본값은 `dm`입니다. DM 전송 실패 시 자동으로 채널 알림으로 전환됩니다.

### `/setup status` — 등록 상태 확인

현재 등록된 계정 정보를 확인합니다:
- 베트맨 아이디
- 알림 방식 (dm/channel)
- 등록일

### `/setup remove` — 계정 등록 해제

등록된 계정을 삭제합니다. 삭제 후에는 `/betman` 등 조회 명령어를 사용할 수 없습니다.

---

## 구매내역 조회 (`/betman`)

### `/betman` — 수동 즉시 조회

등록된 베트맨 계정으로 즉시 구매내역을 스크래핑합니다.

- **발매중/발매마감** 상태의 구매 건을 조회
- 새로 발견된 건은 알림으로 전송
- 결과: `조회 완료: N건 발견, M건 새로 전송`

> 봇은 자동으로 주기적(기본 30분)으로 스크래핑하므로, 이 명령어는 즉시 확인이 필요할 때 사용합니다.

---

## 구매내역 상세 조회 (`/purchases`)

### `/purchases` — 경기/배당/선택 포함 상세 조회

`/betman`과 달리 **모든 구매 건을 임베드로 하나씩 전송**합니다.
각 건의 경기 상세 정보(리그, 팀, 선택, 배당)를 포함합니다.

- 결과: `구매내역 N건 조회 완료` 메시지 + 각 건별 임베드

> 구매 건이 많으면 메시지가 여러 개 전송됩니다.

---

## 경기 목록 조회 (`/games`)

### `/games` — 구매 가능한 경기 조회

현재 프로토 승부식에서 구매 가능한 전체 경기 목록을 조회합니다.

```
/games                # 전체 경기 목록
/games sport:축구     # 축구 경기만 필터
/games sport:농구     # 농구 경기만 필터
/games sport:야구     # 야구 경기만 필터
/games sport:배구     # 배구 경기만 필터
```

각 경기에 대해 다음 정보가 표시됩니다:

| 항목 | 예시 |
|------|------|
| 경기 번호 | #162 |
| 리그 | K리그1, EPL 등 |
| 게임 유형 | 일반, [H]핸디캡, [U/O]언더오버, [SUM] |
| 홈/원정 | 전북 vs 울산 |
| 배당 | 승:1.85 \| 무:3.20 \| 패:4.10 |
| 마감시간 | 02.15 (토) 14:00 마감 |
| 경기장 | 전주월드컵경기장 |

> 경기가 25개를 초과하면 여러 임베드로 분할 전송됩니다.

---

## 알림 형식

### 구매 알림

새로운 구매 건이 발견되면 아래 형식의 임베드가 전송됩니다:

```
┌──────────────────────────────────┐
│ 프로토 승부식 제42회              │
├──────────────────────────────────┤
│ 상태: 발매중                      │
│ 구매일시: 2026-02-12 15:30       │
│                                  │
│ #1 K리그1                        │
│ 전북 vs 울산                     │
│ 선택: 승 | 배당: 1.85            │
│ 경기시간: 2026-02-15 14:00       │
│                                  │
│ #2 프리미어리그                   │
│ 리버풀 vs 맨시티                 │
│ 선택: 무 | 배당: 3.40            │
│ 경기시간: 2026-02-16 01:30       │
├──────────────────────────────────┤
│ 구매금액: 10,000원               │
│ 예상적중금: 62,900원             │
│ 합산배당: 6.29                   │
└──────────────────────────────────┘
```

- 상태별 색상: 발매중(초록), 발매마감(주황), 적중(금색), 미적중(빨강), 취소(회색)

### 결과 알림

경기 결과가 확정되면 별도의 결과 알림이 전송됩니다:

- **적중**: `🎉 적중!` — 적중금액, 수익 표시
- **미적중**: `😢 미적중` — 손실 금액 표시
- **취소**: `🚫 취소`

---

## 통계 조회 (`/stats`)

### `/stats` — 전체 통계

모든 기간의 베팅 통계를 한눈에 확인:

| 항목 | 설명 |
|------|------|
| 총 베팅 수 | 전체 구매 건수 |
| 적중 / 미적중 | 결과별 건수 |
| 적중률 | 적중 / (적중 + 미적중) % |
| 총 구매금액 | 투자한 총 금액 |
| 총 적중금액 | 받은 총 금액 |
| 손익 | 적중금액 - 구매금액 |
| 대기 중 | 아직 결과가 나오지 않은 건수 |

### `/stats period:일별 (7일)` — 일별 통계

최근 7일간의 일별 베팅 현황:
- 날짜별 베팅 수, 적중 수, 투자 금액, 손익

### `/stats period:월별 (6개월)` — 월별 통계

최근 6개월간의 월별 베팅 현황:
- 월별 베팅 수, 적중 수, 투자 금액, 손익

---

## 알림 필터 (`/filter`)

알림을 받을 조건을 설정합니다. 필터를 설정하지 않으면 모든 구매 건에 대해 알림을 받습니다.

### `/filter show` — 현재 필터 확인

설정된 모든 필터를 한눈에 확인합니다.
필터가 없으면 `"설정된 필터가 없습니다. (모든 알림 수신)"` 표시.

### `/filter min-amount` — 최소 금액 필터

지정한 금액 이상의 구매 건만 알림을 받습니다.

```
/filter min-amount amount:5000    # 5,000원 이상만 알림
/filter min-amount amount:10000   # 10,000원 이상만 알림
/filter min-amount amount:0       # 필터 해제 (모든 금액 알림)
```

### `/filter game-type` — 게임 유형 필터

특정 게임 유형의 구매 건만 알림을 받습니다.

```
/filter game-type action:추가 game_type:프로토     # 프로토만 알림
/filter game-type action:추가 game_type:토토       # 토토도 추가
/filter game-type action:제거 game_type:토토       # 토토 제거
/filter game-type action:초기화                    # 유형 필터 전체 해제
```

게임 유형 예시: `프로토`, `토토`, `승부식`, `기록식`

### `/filter sport` — 종목 필터

특정 스포츠 종목의 경기가 포함된 구매 건만 알림을 받습니다.

```
/filter sport action:추가 sport:축구      # 축구 경기 포함된 건만 알림
/filter sport action:추가 sport:야구      # 야구도 추가
/filter sport action:제거 sport:야구      # 야구 제거
/filter sport action:초기화               # 종목 필터 전체 해제
```

종목 예시: `축구`, `야구`, `농구`, `배구`, `핸드볼`

### 필터 동작 방식

- **필터 미설정** → 모든 구매 건 알림
- **복수 필터 설정** → 모든 조건을 만족하는 건만 알림 (AND 조건)
- **같은 종류 복수 값** → 하나라도 일치하면 통과 (OR 조건)

예시: 최소 금액 5,000원 + 종목 축구/야구 설정 시
→ 5,000원 이상이면서 축구 또는 야구 경기가 포함된 건만 알림

> 필터는 서버 전체에 공통으로 적용됩니다.

---

## 자동 스크래핑

봇은 설정된 주기(기본 30분)마다 등록된 모든 사용자의 구매내역을 자동으로 스크래핑합니다.

### 동작 흐름

1. 등록된 각 사용자별로 베트맨에 로그인
2. 구매내역 페이지에서 데이터 수집 (XHR 캡처 → DOM 파싱 폴백)
3. 새로운 구매 건 → 구매 알림 전송
4. 결과가 확정된 건 → 결과 알림 전송
5. 세션을 저장하여 다음 스크래핑 시 재로그인 최소화

### 알림 종류

| 알림 | 발생 시점 | 내용 |
|------|----------|------|
| 구매 알림 | 새 구매 건 발견 시 | 경기 정보, 배당, 금액 |
| 결과 알림 | 경기 결과 확정 시 | 적중/미적중, 수익/손실 |

---

## 멀티 유저 지원

- 여러 사용자가 각각 `/setup register`로 자신의 계정을 등록할 수 있습니다
- 각 사용자별로 독립적인 세션과 데이터가 관리됩니다
- 알림은 각 사용자의 설정(DM/채널)에 따라 개별 전송됩니다

---

## 명령어 요약

| 명령어 | 설명 |
|--------|------|
| `/setup register` | 베트맨 계정 등록 |
| `/setup status` | 등록 상태 확인 |
| `/setup remove` | 계정 등록 해제 |
| `/betman` | 수동 즉시 조회 |
| `/purchases` | 구매내역 상세 조회 (경기/배당 포함) |
| `/games` | 구매 가능한 경기 목록 조회 |
| `/games sport:축구` | 특정 종목만 필터링 |
| `/stats` | 전체 통계 |
| `/stats period:일별 (7일)` | 7일간 일별 통계 |
| `/stats period:월별 (6개월)` | 6개월간 월별 통계 |
| `/filter show` | 현재 필터 확인 |
| `/filter min-amount` | 최소 금액 필터 |
| `/filter game-type` | 게임 유형 필터 |
| `/filter sport` | 종목 필터 |
